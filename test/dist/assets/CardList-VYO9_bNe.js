import{d as le,k as _,c as ae,o as te,a as k,b as c,e as a,w as t,g as s,f as ne,l as oe,h as x,i as u,F as se,r as ue,m as de,p as L,j as ie,t as m,u as N,E as f,q as E,_ as re}from"./index-x4DXS2Vx.js";import{u as ce}from"./cardStore-BOWisUcD.js";import"./index-j8vyhiJM.js";import"./index-B9ygI19o.js";const me={class:"card-list-page"},pe={class:"page-header"},fe={class:"card-number"},ve={class:"balance"},be={key:0,class:"empty-state"},_e={class:"form-tip"},ge={key:0,class:"recharge-info"},ye=le({__name:"CardList",setup(Ce){const I=ne(),d=ce(),o=_({cardNumber:"",status:"",balanceMin:void 0,balanceMax:void 0}),g=_(!1),y=_(!1),v=_(null),C=_({initialBalance:0}),r=_({amount:0,description:""}),D=ae(()=>d.cards.filter(n=>!(o.value.cardNumber&&!(n.cardNumber||"").includes(o.value.cardNumber)||o.value.status&&n.status!==o.value.status||o.value.balanceMin!==void 0&&n.balance<o.value.balanceMin||o.value.balanceMax!==void 0&&n.balance>o.value.balanceMax))),R=[{value:"",label:"全部"},{value:"active",label:"正常"},{value:"frozen",label:"已冻结"},{value:"cancelled",label:"已注销"}];te(()=>{d.fetchCards()});const T=()=>{o.value={cardNumber:"",status:"",balanceMin:void 0,balanceMax:void 0}},Y=async()=>{try{await d.createCard(C.value.initialBalance||void 0),f.success("卡片创建成功"),g.value=!1,C.value.initialBalance=0}catch{f.error("创建失败，请重试")}},q=n=>{v.value=n,r.value={amount:0,description:""},y.value=!0},A=async()=>{if(v.value){if(r.value.amount<=0){f.warning("请输入有效金额");return}try{await d.rechargeCard(v.value.id,r.value.amount,r.value.description),f.success("充值成功"),y.value=!1}catch{f.error("充值失败，请重试")}}},P=async n=>{const e=n.status==="active"?"frozen":"active",V=e==="frozen"?"冻结":"解冻";try{await E.confirm(`确定要${V}此卡片吗？`,`${V}确认`,{type:"warning"}),await d.updateCardStatus(n.id,e),f.success(`${V}成功`)}catch{}},j=async n=>{try{await E.confirm("注销后卡片将无法恢复，确定要注销吗？","注销确认",{type:"error"}),await d.cancelCard(n.id),f.success("卡片已注销")}catch{}},O=n=>{I.push({name:"CardDetail",params:{id:n.id}})},$=n=>new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(n),B=n=>n?n.replace(/(.{4})/g,"$1 ").trim():"****************",G=n=>({active:"success",frozen:"warning",cancelled:"danger"})[n]||"info",H=n=>({active:"正常",frozen:"已冻结",cancelled:"已注销"})[n]||n;return(n,e)=>{const V=s("Plus"),S=s("el-icon"),i=s("el-button"),h=s("el-input"),p=s("el-form-item"),J=s("el-option"),K=s("el-select"),w=s("el-input-number"),M=s("el-form"),F=s("el-card"),b=s("el-table-column"),Q=s("el-tag"),W=s("el-table"),X=s("el-empty"),Z=s("InfoFilled"),U=s("el-dialog"),ee=oe("loading");return x(),k("div",me,[c("div",pe,[e[13]||(e[13]=c("h1",{class:"page-title"},"卡片管理",-1)),a(i,{type:"primary",onClick:e[0]||(e[0]=l=>g.value=!0)},{default:t(()=>[a(S,null,{default:t(()=>[a(V)]),_:1}),e[12]||(e[12]=u(" 生成新卡 ",-1))]),_:1})]),a(F,{class:"search-card"},{default:t(()=>[a(M,{inline:!0,model:o.value,class:"search-form"},{default:t(()=>[a(p,{label:"卡号"},{default:t(()=>[a(h,{modelValue:o.value.cardNumber,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.cardNumber=l),placeholder:"输入卡号搜索",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),a(p,{label:"状态"},{default:t(()=>[a(K,{modelValue:o.value.status,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.status=l),placeholder:"全部",style:{width:"120px"}},{default:t(()=>[(x(),k(se,null,ue(R,l=>a(J,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"余额范围"},{default:t(()=>[a(w,{modelValue:o.value.balanceMin,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.balanceMin=l),min:0,controls:!1,placeholder:"最小值",style:{width:"120px"}},null,8,["modelValue"]),e[14]||(e[14]=c("span",{style:{margin:"0 8px",color:"var(--text-muted)"}},"至",-1)),a(w,{modelValue:o.value.balanceMax,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.balanceMax=l),min:0,controls:!1,placeholder:"最大值",style:{width:"120px"}},null,8,["modelValue"])]),_:1}),a(p,null,{default:t(()=>[a(i,{onClick:T},{default:t(()=>[...e[15]||(e[15]=[u("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(F,{class:"table-card"},{default:t(()=>[de((x(),ie(W,{data:D.value,stripe:"",style:{width:"100%"}},{default:t(()=>[a(b,{label:"卡号","min-width":"200"},{default:t(({row:l})=>[c("span",fe,m(B(l.cardNumber)),1)]),_:1}),a(b,{label:"状态",width:"100"},{default:t(({row:l})=>[a(Q,{type:G(l.status),size:"small"},{default:t(()=>[u(m(H(l.status)),1)]),_:2},1032,["type"])]),_:1}),a(b,{label:"余额",width:"120"},{default:t(({row:l})=>[c("span",ve,m($(l.balance)),1)]),_:1}),a(b,{label:"有效期",width:"100"},{default:t(({row:l})=>[u(m(l.expiryDate?new Date(l.expiryDate).toLocaleDateString():"MM/YY"),1)]),_:1}),a(b,{label:"创建时间",width:"180"},{default:t(({row:l})=>[u(m(l.createdAt?new Date(l.createdAt).toLocaleString():"-"),1)]),_:1}),a(b,{label:"操作",width:"280",fixed:"right"},{default:t(({row:l})=>[a(i,{size:"small",onClick:z=>O(l)},{default:t(()=>[...e[16]||(e[16]=[u("详情",-1)])]),_:1},8,["onClick"]),a(i,{size:"small",disabled:l.status==="cancelled",onClick:z=>q(l)},{default:t(()=>[...e[17]||(e[17]=[u("充值",-1)])]),_:1},8,["disabled","onClick"]),a(i,{size:"small",disabled:l.status==="cancelled",onClick:z=>P(l)},{default:t(()=>[u(m(l.status==="frozen"?"解冻":"冻结"),1)]),_:2},1032,["disabled","onClick"]),a(i,{size:"small",type:"danger",disabled:l.status==="cancelled",onClick:z=>j(l)},{default:t(()=>[...e[18]||(e[18]=[u("注销",-1)])]),_:1},8,["disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[ee,N(d).loading]]),D.value.length===0&&!N(d).loading?(x(),k("div",be,[a(X,{description:"没有找到匹配的卡片"})])):L("",!0)]),_:1}),a(U,{modelValue:g.value,"onUpdate:modelValue":e[7]||(e[7]=l=>g.value=l),title:"生成新卡片",width:"400px"},{footer:t(()=>[a(i,{onClick:e[6]||(e[6]=l=>g.value=!1)},{default:t(()=>[...e[20]||(e[20]=[u("取消",-1)])]),_:1}),a(i,{type:"primary",loading:N(d).loading,onClick:Y},{default:t(()=>[...e[21]||(e[21]=[u("确认生成",-1)])]),_:1},8,["loading"])]),default:t(()=>[a(M,{model:C.value,"label-width":"80px"},{default:t(()=>[a(p,{label:"初始余额"},{default:t(()=>[a(w,{modelValue:C.value.initialBalance,"onUpdate:modelValue":e[5]||(e[5]=l=>C.value.initialBalance=l),min:0,precision:2,step:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),c("p",_e,[a(S,null,{default:t(()=>[a(Z)]),_:1}),e[19]||(e[19]=u("留空或设为 0 将创建余额为 0 的卡片",-1))])]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(U,{modelValue:y.value,"onUpdate:modelValue":e[11]||(e[11]=l=>y.value=l),title:"充值",width:"400px"},{footer:t(()=>[a(i,{onClick:e[10]||(e[10]=l=>y.value=!1)},{default:t(()=>[...e[22]||(e[22]=[u("取消",-1)])]),_:1}),a(i,{type:"primary",loading:N(d).loading,onClick:A},{default:t(()=>[...e[23]||(e[23]=[u("确认充值",-1)])]),_:1},8,["loading"])]),default:t(()=>[v.value?(x(),k("div",ge,[c("p",null,"卡号："+m(B(v.value.cardNumber)),1),c("p",null,"当前余额："+m($(v.value.balance)),1)])):L("",!0),a(M,{model:r.value,"label-width":"80px"},{default:t(()=>[a(p,{label:"充值金额",required:""},{default:t(()=>[a(w,{modelValue:r.value.amount,"onUpdate:modelValue":e[8]||(e[8]=l=>r.value.amount=l),min:.01,precision:2,step:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(p,{label:"备注"},{default:t(()=>[a(h,{modelValue:r.value.description,"onUpdate:modelValue":e[9]||(e[9]=l=>r.value.description=l),placeholder:"可选"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Ne=re(ye,[["__scopeId","data-v-6c3d081d"]]);export{Ne as default};
