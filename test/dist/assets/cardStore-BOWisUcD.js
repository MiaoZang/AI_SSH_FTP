import{A as B,k as v,c as f}from"./index-x4DXS2Vx.js";import{c as s}from"./index-j8vyhiJM.js";const T=B("card",()=>{const u=v([]),c=v(null),o=v([]),t=v(!1),l=v(null),d=f(()=>u.value.filter(a=>a.status==="active").reduce((a,e)=>a+e.balance,0)),y=f(()=>u.value.filter(a=>a.status==="active")),h=f(()=>u.value.filter(a=>a.status==="frozen"));async function C(){t.value=!0,l.value=null;try{u.value=await s.getCards()}catch(a){l.value=a.message||"获取卡片列表失败"}finally{t.value=!1}}async function w(a){t.value=!0,l.value=null;try{c.value=await s.getCard(a)}catch(e){l.value=e.message||"获取卡片详情失败"}finally{t.value=!1}}async function g(a){t.value=!0,l.value=null;try{const e=await s.createCard({initialBalance:a});return u.value.unshift(e),e}catch(e){throw l.value=e.message||"创建卡片失败",e}finally{t.value=!1}}async function m(a,e,n){t.value=!0,l.value=null;try{const r=await s.recharge(a,{amount:e,description:n}),i=u.value.find(x=>x.id===a);return i&&(i.balance=r.newBalance),c.value?.id===a&&(c.value.balance=r.newBalance),r}catch(r){throw l.value=r.message||"充值失败",r}finally{t.value=!1}}async function p(a,e){t.value=!0,l.value=null;try{const n=await s.updateStatus(a,e),r=u.value.findIndex(i=>i.id===a);return r!==-1&&(u.value[r]=n),c.value?.id===a&&(c.value=n),n}catch(n){throw l.value=n.message||"更新状态失败",n}finally{t.value=!1}}async function S(a){t.value=!0,l.value=null;try{await s.cancelCard(a);const e=u.value.find(n=>n.id===a);e&&(e.status="cancelled"),c.value?.id===a&&(c.value.status="cancelled")}catch(e){throw l.value=e.message||"注销卡片失败",e}finally{t.value=!1}}async function b(a){t.value=!0,l.value=null;try{o.value=await s.getTransactions(a)}catch(e){l.value=e.message||"获取交易记录失败"}finally{t.value=!1}}return{cards:u,currentCard:c,transactions:o,loading:t,error:l,totalBalance:d,activeCards:y,frozenCards:h,fetchCards:C,fetchCard:w,createCard:g,rechargeCard:m,updateCardStatus:p,cancelCard:S,fetchTransactions:b}});export{T as u};
