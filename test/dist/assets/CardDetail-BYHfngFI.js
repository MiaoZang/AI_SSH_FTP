import{d as Z,c as k,k as V,o as ee,a as g,b as a,e as t,w as n,u as x,f as te,i as r,t as u,j as h,p as L,x as S,E as _,g as l,y as ae,h as m,z as A,q as B,_ as se}from"./index-x4DXS2Vx.js";import{u as ne}from"./cardStore-BOWisUcD.js";import{V as oe}from"./VirtualCard-CZ9vNFkp.js";import"./index-j8vyhiJM.js";import"./index-B9ygI19o.js";const le={class:"card-detail-page"},ie={class:"back-nav"},ue={key:0,class:"loading-state"},de={key:1,class:"empty-state"},re={key:2,class:"detail-content"},ce={class:"detail-grid"},pe={class:"card-section"},me={class:"action-buttons"},ve={class:"info-section"},_e={class:"info-list"},fe={class:"info-item"},ye={class:"info-value"},ge={class:"info-item"},be={class:"info-value"},Ce={class:"info-item"},we={class:"info-value"},ke={class:"info-item"},Ve={class:"info-value highlight"},xe={class:"info-item"},he={class:"info-item"},ze={class:"info-value"},De={class:"transactions-section"},Ne={key:0,class:"recharge-info"},$e=Z({__name:"CardDetail",setup(Te){const M=ae(),z=te(),d=ne(),C=k(()=>M.params.id),f=V(!1),y=V(!1),c=V({amount:0,description:""});ee(async()=>{await d.fetchCard(C.value),await d.fetchTransactions(C.value)});const s=k(()=>d.currentCard),E=k(()=>d.transactions),w=i=>new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(i),D=i=>new Date(i).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),U=i=>({recharge:"充值",consume:"消费",refund:"退款"})[i]||i,F=i=>({recharge:"success",consume:"danger",refund:"info"})[i]||"",I=async()=>{if(s.value){if(c.value.amount<=0){_.warning("请输入有效金额");return}try{await d.rechargeCard(s.value.id,c.value.amount,c.value.description),_.success("充值成功"),y.value=!1,c.value={amount:0,description:""},await d.fetchTransactions(C.value)}catch{_.error("充值失败")}}},R=async()=>{if(!s.value)return;const i=s.value.status==="active"?"frozen":"active",e=i==="frozen"?"冻结":"解冻";try{await B.confirm(`确定要${e}此卡片吗？`,`${e}确认`,{type:"warning"}),await d.updateCardStatus(s.value.id,i),_.success(`${e}成功`)}catch{}},q=async()=>{if(s.value)try{await B.confirm("注销后卡片将无法恢复，确定要注销吗？","注销确认",{type:"error"}),await d.cancelCard(s.value.id),_.success("卡片已注销"),z.push({name:"CardList"})}catch{}},N=(i,e)=>{navigator.clipboard.writeText(i),_.success(`${e}已复制`)};return(i,e)=>{const j=l("ArrowLeft"),v=l("el-icon"),p=l("el-button"),H=l("el-skeleton"),Y=l("el-empty"),G=l("Money"),J=l("Delete"),$=l("CopyDocument"),b=l("el-table-column"),K=l("el-tag"),O=l("el-table"),P=l("el-input-number"),T=l("el-form-item"),Q=l("el-input"),W=l("el-form"),X=l("el-dialog");return m(),g("div",le,[a("div",ie,[t(p,{text:"",onClick:e[0]||(e[0]=o=>x(z).push({name:"CardList"}))},{default:n(()=>[t(v,null,{default:n(()=>[t(j)]),_:1}),e[9]||(e[9]=r(" 返回列表 ",-1))]),_:1})]),x(d).loading&&!s.value?(m(),g("div",ue,[t(H,{rows:5,animated:""})])):s.value?(m(),g("div",re,[a("div",ce,[a("div",pe,[t(oe,{card:s.value,"gradient-index":0},null,8,["card"]),a("div",me,[t(p,{type:"primary",size:"large",disabled:s.value.status==="cancelled",onClick:e[1]||(e[1]=o=>y.value=!0)},{default:n(()=>[t(v,null,{default:n(()=>[t(G)]),_:1}),e[10]||(e[10]=r(" 充值 ",-1))]),_:1},8,["disabled"]),t(p,{size:"large",disabled:s.value.status==="cancelled",onClick:R},{default:n(()=>[t(v,null,{default:n(()=>[(m(),h(A(s.value.status==="frozen"?"Unlock":"Lock")))]),_:1}),r(" "+u(s.value.status==="frozen"?"解冻":"冻结"),1)]),_:1},8,["disabled"]),t(p,{type:"danger",size:"large",disabled:s.value.status==="cancelled",onClick:q},{default:n(()=>[t(v,null,{default:n(()=>[t(J)]),_:1}),e[11]||(e[11]=r(" 注销 ",-1))]),_:1},8,["disabled"])])]),a("div",ve,[e[18]||(e[18]=a("h2",null,"卡片信息",-1)),a("div",_e,[a("div",fe,[e[12]||(e[12]=a("span",{class:"info-label"},"卡号",-1)),a("span",ye,[r(u(s.value.cardNumber)+" ",1),t(p,{text:"",size:"small",onClick:e[2]||(e[2]=o=>N(s.value.cardNumber,"卡号"))},{default:n(()=>[t(v,null,{default:n(()=>[t($)]),_:1})]),_:1})])]),a("div",ge,[e[13]||(e[13]=a("span",{class:"info-label"},"有效期",-1)),a("span",be,u(s.value.expiryDate),1)]),a("div",Ce,[e[14]||(e[14]=a("span",{class:"info-label"},"CVV",-1)),a("span",we,[r(u(f.value?s.value.cvv:"***")+" ",1),t(p,{text:"",size:"small",onClick:e[3]||(e[3]=o=>f.value=!f.value)},{default:n(()=>[t(v,null,{default:n(()=>[(m(),h(A(f.value?"Hide":"View")))]),_:1})]),_:1}),f.value?(m(),h(p,{key:0,text:"",size:"small",onClick:e[4]||(e[4]=o=>N(s.value.cvv,"CVV"))},{default:n(()=>[t(v,null,{default:n(()=>[t($)]),_:1})]),_:1})):L("",!0)])]),a("div",ke,[e[15]||(e[15]=a("span",{class:"info-label"},"余额",-1)),a("span",Ve,u(w(s.value.balance)),1)]),a("div",xe,[e[16]||(e[16]=a("span",{class:"info-label"},"状态",-1)),a("span",{class:S(["status-badge",s.value.status])},u(s.value.status==="active"?"正常":s.value.status==="frozen"?"已冻结":"已注销"),3)]),a("div",he,[e[17]||(e[17]=a("span",{class:"info-label"},"创建时间",-1)),a("span",ze,u(D(s.value.createdAt)),1)])])])]),a("div",De,[e[19]||(e[19]=a("h2",null,"交易记录",-1)),t(O,{data:E.value,stripe:"",style:{width:"100%"},"empty-text":"暂无交易记录"},{default:n(()=>[t(b,{prop:"createdAt",label:"时间",width:"180"},{default:n(({row:o})=>[r(u(D(o.createdAt)),1)]),_:1}),t(b,{prop:"type",label:"类型",width:"100"},{default:n(({row:o})=>[t(K,{type:F(o.type),size:"small"},{default:n(()=>[r(u(U(o.type)),1)]),_:2},1032,["type"])]),_:1}),t(b,{prop:"amount",label:"金额",width:"150"},{default:n(({row:o})=>[a("span",{class:S(o.type==="consume"?"amount-negative":"amount-positive")},u(o.type==="consume"?"-":"+")+u(w(o.amount)),3)]),_:1}),t(b,{prop:"description",label:"描述"})]),_:1},8,["data"])])])):(m(),g("div",de,[t(Y,{description:"卡片不存在"})])),t(X,{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=o=>y.value=o),title:"充值",width:"400px"},{footer:n(()=>[t(p,{onClick:e[7]||(e[7]=o=>y.value=!1)},{default:n(()=>[...e[20]||(e[20]=[r("取消",-1)])]),_:1}),t(p,{type:"primary",loading:x(d).loading,onClick:I},{default:n(()=>[...e[21]||(e[21]=[r(" 确认充值 ",-1)])]),_:1},8,["loading"])]),default:n(()=>[s.value?(m(),g("div",Ne,[a("p",null,"当前余额："+u(w(s.value.balance)),1)])):L("",!0),t(W,{model:c.value,"label-width":"80px"},{default:n(()=>[t(T,{label:"充值金额",required:""},{default:n(()=>[t(P,{modelValue:c.value.amount,"onUpdate:modelValue":e[5]||(e[5]=o=>c.value.amount=o),min:.01,precision:2,step:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(T,{label:"备注"},{default:n(()=>[t(Q,{modelValue:c.value.description,"onUpdate:modelValue":e[6]||(e[6]=o=>c.value.description=o),placeholder:"可选"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Ee=se($e,[["__scopeId","data-v-aa14c3e9"]]);export{Ee as default};
