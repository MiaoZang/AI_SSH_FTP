import{a as o}from"./auth-LOQg4seF.js";import{d as $,k as g,o as B,E as c,a as E,b as l,e as s,m as M,l as z,j as L,w as n,g as r,h as w,i as d,t as p,q as A,_ as T}from"./index-x4DXS2Vx.js";import"./index-j8vyhiJM.js";import"./index-B9ygI19o.js";const j={class:"user-management-page"},q={class:"settings-card card"},I={class:"setting-item"},S={class:"table-container card"},F=$({__name:"UserManagement",setup(G){const f=g([]),m=g(!1),u=g(!0),_=g(!1);B(async()=>{await v(),await b()});const v=async()=>{m.value=!0;try{f.value=await o.getAllUsers()}catch{c.error("获取用户列表失败")}finally{m.value=!1}},b=async()=>{try{const e=await o.getAutoRegister();u.value=e.enabled}catch{}},C=async e=>{_.value=!0;try{await o.setAutoRegister(e),c.success(e?"已开启自动注册":"已关闭自动注册")}catch{c.error("设置失败"),u.value=!e}finally{_.value=!1}},x=async e=>{try{await A.confirm(`确定要${e.isActive?"禁用":"启用"}用户 "${e.displayName}" 吗？`,"确认操作"),await o.toggleUserActive(e.id),c.success(`已${e.isActive?"禁用":"启用"}用户`),await v()}catch{}},k=async e=>{try{await A.confirm(`确定要删除用户 "${e.displayName}" 吗？此操作不可撤销！`,"删除确认",{type:"error"}),await o.deleteUser(e.id),c.success("用户已删除"),await v()}catch{}},h=e=>e?new Date(e).toLocaleString("zh-CN"):"-";return(e,a)=>{const N=r("el-switch"),i=r("el-table-column"),U=r("el-tag"),y=r("el-button"),D=r("el-table"),R=z("loading");return w(),E("div",j,[a[4]||(a[4]=l("div",{class:"page-header"},[l("h1",{class:"page-title"},"用户管理")],-1)),l("div",q,[a[2]||(a[2]=l("h3",null,"系统设置",-1)),l("div",I,[a[1]||(a[1]=l("div",{class:"setting-info"},[l("span",{class:"setting-label"},"自动注册"),l("span",{class:"setting-desc"},"开启后，新用户名首次登录时自动创建账户")],-1)),s(N,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=t=>u.value=t),loading:_.value,onChange:C},null,8,["modelValue","loading"])])]),l("div",S,[M((w(),L(D,{data:f.value,stripe:""},{default:n(()=>[s(i,{label:"用户名",prop:"username",width:"150"}),s(i,{label:"显示名",prop:"displayName",width:"150"}),s(i,{label:"状态",width:"100"},{default:n(({row:t})=>[s(U,{type:t.isActive?"success":"danger",size:"small"},{default:n(()=>[d(p(t.isActive?"正常":"已禁用"),1)]),_:2},1032,["type"])]),_:1}),s(i,{label:"创建时间",width:"170"},{default:n(({row:t})=>[d(p(h(t.createdAt)),1)]),_:1}),s(i,{label:"最后登录",width:"170"},{default:n(({row:t})=>[d(p(h(t.lastLoginAt)),1)]),_:1}),s(i,{label:"操作",width:"150",fixed:"right"},{default:n(({row:t})=>[s(y,{type:t.isActive?"warning":"success",size:"small",text:"",onClick:V=>x(t)},{default:n(()=>[d(p(t.isActive?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),s(y,{type:"danger",size:"small",text:"",onClick:V=>k(t)},{default:n(()=>[...a[3]||(a[3]=[d(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[R,m.value]])])])}}}),P=T(F,[["__scopeId","data-v-9e3eed14"]]);export{P as default};
