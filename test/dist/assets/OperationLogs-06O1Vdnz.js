import{a as P}from"./index-j8vyhiJM.js";import{d as j,k as g,o as A,a as v,b as u,e,w as l,m as U,l as E,j as x,g as s,h as p,i as d,t as i,_ as J}from"./index-x4DXS2Vx.js";import"./index-B9ygI19o.js";const M={getLogs:y=>P.get("/logs",{params:y})},q={class:"logs-page"},F={class:"filter-bar card"},G={class:"table-container card"},H={key:0},K={key:1,class:"text-muted"},Q={class:"details-json"},R={key:1,class:"text-muted"},W={class:"pagination-bar"},X=j({__name:"OperationLogs",setup(y){const f=g([]),m=g(!1),_=g({page:1,pageSize:20,total:0,totalPages:0}),c=g({action:"",targetType:"",startDate:"",endDate:""});A(()=>{b()});const b=async(o=1)=>{m.value=!0;try{const t=await M.getLogs({page:o,pageSize:_.value.pageSize,action:c.value.action||void 0,targetType:c.value.targetType||void 0,startDate:c.value.startDate||void 0,endDate:c.value.endDate||void 0});f.value=t.logs,_.value=t.pagination}catch(t){console.error("获取日志失败:",t)}finally{m.value=!1}},D=()=>{b(1)},w=o=>{b(o)},S=o=>new Date(o).toLocaleString("zh-CN"),T=o=>({login:"登录",logout:"登出",create_card_keys:"生成卡密",activate_card_key:"激活卡密",cancel_card_key:"注销卡密",batch_activate_card_keys:"批量激活",batch_cancel_card_keys:"批量注销",change_mode:"切换模式"})[o]||o,z=o=>({user:"用户",card_key:"卡密",virtual_card:"虚拟卡",system_config:"系统配置"})[o]||o;return(o,t)=>{const n=s("el-option"),h=s("el-select"),V=s("Search"),C=s("el-icon"),k=s("el-button"),r=s("el-table-column"),L=s("el-tag"),N=s("el-popover"),I=s("el-table"),B=s("el-pagination"),O=E("loading");return p(),v("div",q,[t[5]||(t[5]=u("div",{class:"page-header"},[u("h1",{class:"page-title"},"操作日志")],-1)),u("div",F,[e(h,{modelValue:c.value.action,"onUpdate:modelValue":t[0]||(t[0]=a=>c.value.action=a),placeholder:"操作类型",clearable:"",style:{width:"140px"}},{default:l(()=>[e(n,{label:"登录",value:"login"}),e(n,{label:"生成卡密",value:"create_card_keys"}),e(n,{label:"激活卡密",value:"activate_card_key"}),e(n,{label:"注销卡密",value:"cancel_card_key"}),e(n,{label:"批量激活",value:"batch_activate_card_keys"}),e(n,{label:"批量注销",value:"batch_cancel_card_keys"}),e(n,{label:"切换模式",value:"change_mode"})]),_:1},8,["modelValue"]),e(h,{modelValue:c.value.targetType,"onUpdate:modelValue":t[1]||(t[1]=a=>c.value.targetType=a),placeholder:"目标类型",clearable:"",style:{width:"120px"}},{default:l(()=>[e(n,{label:"用户",value:"user"}),e(n,{label:"卡密",value:"card_key"}),e(n,{label:"虚拟卡",value:"virtual_card"}),e(n,{label:"系统配置",value:"system_config"})]),_:1},8,["modelValue"]),e(k,{onClick:D},{default:l(()=>[e(C,null,{default:l(()=>[e(V)]),_:1}),t[3]||(t[3]=d(" 搜索 ",-1))]),_:1})]),u("div",G,[U((p(),x(I,{data:f.value,stripe:""},{default:l(()=>[e(r,{label:"时间",width:"170"},{default:l(({row:a})=>[d(i(S(a.createdAt)),1)]),_:1}),e(r,{label:"操作者",width:"120"},{default:l(({row:a})=>[d(i(a.user?.displayName||"-"),1)]),_:1}),e(r,{label:"操作",width:"120"},{default:l(({row:a})=>[e(L,{size:"small"},{default:l(()=>[d(i(T(a.action)),1)]),_:2},1024)]),_:1}),e(r,{label:"目标类型",width:"100"},{default:l(({row:a})=>[d(i(z(a.targetType)),1)]),_:1}),e(r,{label:"目标 ID",width:"280"},{default:l(({row:a})=>[a.targetId?(p(),v("code",H,i(a.targetId),1)):(p(),v("span",K,"-"))]),_:1}),e(r,{label:"详情"},{default:l(({row:a})=>[a.details&&Object.keys(a.details).length?(p(),x(N,{key:0,trigger:"hover",width:"300"},{reference:l(()=>[e(k,{text:"",size:"small"},{default:l(()=>[...t[4]||(t[4]=[d("查看详情",-1)])]),_:1})]),default:l(()=>[u("pre",Q,i(JSON.stringify(a.details,null,2)),1)]),_:2},1024)):(p(),v("span",R,"-"))]),_:1}),e(r,{label:"IP 地址",width:"140"},{default:l(({row:a})=>[d(i(a.ipAddress||"-"),1)]),_:1})]),_:1},8,["data"])),[[O,m.value]]),u("div",W,[e(B,{"current-page":_.value.page,"onUpdate:currentPage":t[2]||(t[2]=a=>_.value.page=a),"page-size":_.value.pageSize,total:_.value.total,layout:"total, prev, pager, next",onCurrentChange:w},null,8,["current-page","page-size","total"])])])])}}}),ee=J(X,[["__scopeId","data-v-cd5a6a7b"]]);export{ee as default};
