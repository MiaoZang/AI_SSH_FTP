import{A as g,k as u,c as s}from"./index-x4DXS2Vx.js";import{a as r}from"./auth-LOQg4seF.js";const k=g("auth",()=>{const l=u(null),t=u(localStorage.getItem("token")),n=u(!1),o=u(null),c=s(()=>!!t.value),i=s(()=>l.value?.username||"");async function v(a){n.value=!0,o.value=null;try{const e=await r.login(a);return l.value=e.user,t.value=e.token,localStorage.setItem("token",e.token),e}catch(e){throw o.value=e.response?.data?.message||"登录失败",e}finally{n.value=!1}}async function f(){try{await r.logout()}catch{}finally{l.value=null,t.value=null,localStorage.removeItem("token")}}async function m(){if(!t.value)return null;n.value=!0;try{const a=await r.getCurrentUser();return l.value=a,a}catch(a){return a.response?.status===401&&(t.value=null,localStorage.removeItem("token")),null}finally{n.value=!1}}return{user:l,token:t,loading:n,error:o,isAuthenticated:c,username:i,login:v,logout:f,fetchCurrentUser:m}});export{k as u};
