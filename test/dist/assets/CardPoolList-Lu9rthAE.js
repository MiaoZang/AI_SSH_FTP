import{d as we,k as m,o as xe,s as P,a as _,b as c,e as l,p as Ce,w as o,F as k,r as S,t as v,E as g,g as d,l as Ve,h as f,i,v as ke,j as M,m as Se,x as $e,q as Pe,_ as Ne}from"./index-x4DXS2Vx.js";const ze={class:"card-pool-page"},Oe={class:"page-header"},Ue={class:"header-actions"},Ie={class:"stats-grid"},je={class:"stat-header"},De={class:"pool-type"},Fe={class:"stat-body"},Be={class:"stat-item"},Ee={class:"stat-value success"},Ke={class:"stat-item"},Je={class:"stat-value"},Le={key:0,class:"batch-actions"},Me={class:"card-number"},Re={key:0},Ae={key:1,class:"text-muted"},Ye={class:"pagination-wrapper"},$="/api/v1/card-pool",qe=we({__name:"CardPoolList",setup(Ge){const U=m(!1),I=m([]),R=m({"0dollar":{unused:0,used:0,total:0},"1dollar":{unused:0,used:0,total:0},"2dollar":{unused:0,used:0,total:0}}),A=m({crawlInterval:30,expireCheckInterval:15}),r=m({page:1,pageSize:20,total:0,totalPages:0}),n=m({search:"",poolType:"",status:"",remainingTimeType:"",cardType:"",accountName:"",cardPrefix:""}),H=[{label:"全部",value:""},{label:"2天21小时 (天级)",value:"days"},{label:"1小时21分钟 (时/分级)",value:"hours"},{label:"长期",value:"longTerm"}],Q=[{label:"全部",value:""},{label:"信用卡",value:"credit"},{label:"借记卡",value:"debit"}],j=m([{label:"全部",value:""}]),D=m([{label:"全部",value:""}]),F=m(!1),X=()=>{const t=localStorage.getItem("cardPoolFilterOptions");if(t)try{const e=JSON.parse(t);e.cardPrefixes&&(j.value=[{label:"全部",value:""},...e.cardPrefixes.map(s=>({label:s,value:s}))]),e.accountNames&&(D.value=[{label:"全部",value:""},...e.accountNames.map(s=>({label:s,value:s}))])}catch(e){console.error("加载缓存筛选选项失败:",e)}},Z=async()=>{F.value=!0;try{const e=await(await fetch(`${$}/filter-options`)).json();if(e.code===200&&e.data){const{cardPrefixes:s,accountNames:p}=e.data;j.value=[{label:"全部",value:""},...s.map(u=>({label:u,value:u}))],D.value=[{label:"全部",value:""},...p.map(u=>({label:u,value:u}))],localStorage.setItem("cardPoolFilterOptions",JSON.stringify({cardPrefixes:s,accountNames:p})),g.success(`已刷新筛选选项：${s.length} 个卡头，${p.length} 个卡台`)}}catch(t){g.error("刷新筛选选项失败："+t.message)}finally{F.value=!1}},T=m([]),N=m(!1),x=m({crawlInterval:30,expireCheckInterval:15}),z=m(!1),C=m({poolType:"0dollar",count:10}),B=m(!1),y=async()=>{U.value=!0;try{const t=new URLSearchParams({page:String(r.value.page),pageSize:String(r.value.pageSize)});n.value.search&&t.append("search",n.value.search),n.value.poolType&&t.append("poolType",n.value.poolType),n.value.status&&t.append("status",n.value.status),n.value.remainingTimeType&&t.append("remainingTimeType",n.value.remainingTimeType),n.value.cardType&&t.append("cardType",n.value.cardType),n.value.accountName&&t.append("accountName",n.value.accountName),n.value.cardPrefix&&t.append("cardPrefix",n.value.cardPrefix);const s=await(await fetch(`${$}?${t}`)).json();s.code===200&&(I.value=s.data.cards,r.value={...r.value,...s.data.pagination})}catch(t){g.error("获取卡池失败: "+t.message)}finally{U.value=!1}},E=async()=>{try{const e=await(await fetch(`${$}/stats`)).json();e.code===200&&(R.value=e.data)}catch(t){console.error("获取统计失败",t)}},ee=async()=>{try{const e=await(await fetch(`${$}/config`)).json();e.code===200&&(A.value=e.data,x.value={...e.data})}catch(t){console.error("获取配置失败",t)}},ae=async()=>{try{const e=await(await fetch(`${$}/config`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(x.value)})).json();e.code===200&&(g.success("配置已更新"),A.value=e.data,N.value=!1)}catch(t){g.error("更新配置失败: "+t.message)}},le=async()=>{if(T.value.length===0)return;const t=I.value.filter(s=>T.value.includes(s.id));if(t.length===0)return;const e=t.map(s=>{const p=s.expYear?.slice(-2)||"??";return`${s.pan}|${s.expMonth}/${p}|${s.cvv}`}).join(`
`);try{await navigator.clipboard.writeText(e),g.success(`已复制 ${t.length} 条卡片信息`)}catch(s){g.error("复制失败"),console.error(s)}},te=async()=>{if(T.value.length===0){g.warning("请先选择卡片");return}await Pe.confirm(`确定删除选中的 ${T.value.length} 张卡片？`,"确认删除",{type:"warning"});try{const e=await(await fetch(`${$}/batch`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:T.value})})).json();e.code===200&&(g.success(`已删除 ${e.data.count} 张卡片`),T.value=[],y(),E())}catch(t){g.error("删除失败: "+t.message)}},oe=async()=>{B.value=!0;try{const t=localStorage.getItem("token");let e="system";if(t)try{const u=JSON.parse(atob(t.split(".")[1]));e=u.userId||u.id||u.sub||"system"}catch{console.warn("Failed to parse JWT token")}const p=await(await fetch(`${$}/generate-keys`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({poolType:C.value.poolType,count:C.value.count,userId:e})})).json();if(p.code===200){g.success(`已生成 ${p.data.count} 个卡密`);const u=p.data.cardKeys.map(K=>K.keyCode).join(`
`);try{await navigator.clipboard.writeText(u),g.success("卡密已复制到剪贴板")}catch{console.log("剪贴板复制失败")}z.value=!1,E()}else g.error(p.message||"生成失败")}catch(t){g.error("生成卡密失败: "+t.message)}finally{B.value=!1}},ne=t=>{T.value=t.map(e=>e.id)},se=t=>{r.value.page=t,y()},ue=t=>{r.value.pageSize=t,r.value.page=1,y()},re=()=>{n.value={search:"",poolType:"",status:"",remainingTimeType:"",cardType:"",accountName:"",cardPrefix:""},r.value.page=1,y()},de=[{value:"",label:"全部"},{value:"0dollar",label:"$0"},{value:"1dollar",label:"$1"},{value:"2dollar",label:"$2"}],ie=[{value:"",label:"全部"},{value:"unused",label:"未使用"},{value:"used",label:"已使用"}],ce=t=>t==="used"?"info":"success",pe=t=>t==="used"?"已使用":"未使用",Y=t=>({"0dollar":"$0","1dollar":"$1","2dollar":"$2"})[t]||t,ve=t=>t?t==="长期"?"time-long":t.includes("小时")&&!t.includes("天")?"time-warning":"time-normal":"",me=t=>t?t.replace(/(\d{4})(?=\d)/g,"$1 "):"";return xe(()=>{X(),y(),E(),ee()}),P(()=>n.value.poolType,()=>{r.value.page=1,y()}),P(()=>n.value.status,()=>{r.value.page=1,y()}),P(()=>n.value.remainingTimeType,()=>{r.value.page=1,y()}),P(()=>n.value.cardType,()=>{r.value.page=1,y()}),P(()=>n.value.cardPrefix,()=>{r.value.page=1,y()}),P(()=>n.value.accountName,()=>{r.value.page=1,y()}),(t,e)=>{const s=d("Key"),p=d("el-icon"),u=d("el-button"),K=d("Setting"),O=d("el-tag"),fe=d("el-input"),b=d("el-form-item"),w=d("el-option"),V=d("el-select"),ge=d("Refresh"),J=d("el-form"),q=d("el-card"),ye=d("CopyDocument"),be=d("Delete"),h=d("el-table-column"),_e=d("el-table"),he=d("el-pagination"),L=d("el-input-number"),G=d("el-dialog"),Te=Ve("loading");return f(),_("div",ze,[c("div",Oe,[e[21]||(e[21]=c("h1",{class:"page-title"},"卡池管理",-1)),c("div",Ue,[l(u,{type:"primary",onClick:e[0]||(e[0]=a=>z.value=!0)},{default:o(()=>[l(p,null,{default:o(()=>[l(s)]),_:1}),e[19]||(e[19]=i(" 生成卡密 ",-1))]),_:1}),l(u,{onClick:e[1]||(e[1]=a=>N.value=!0)},{default:o(()=>[l(p,null,{default:o(()=>[l(K)]),_:1}),e[20]||(e[20]=i(" 配置 ",-1))]),_:1})])]),c("div",Ie,[(f(!0),_(k,null,S(R.value,(a,W)=>(f(),_("div",{class:"stat-card",key:W},[c("div",je,[c("span",De,v(Y(W)),1),l(O,{size:"small",type:"info"},{default:o(()=>[i(v(a.total)+" 张",1)]),_:2},1024)]),c("div",Fe,[c("div",Be,[c("span",Ee,v(a.unused),1),e[22]||(e[22]=c("span",{class:"stat-label"},"可用",-1))]),c("div",Ke,[c("span",Je,v(a.used),1),e[23]||(e[23]=c("span",{class:"stat-label"},"已用",-1))])])]))),128))]),l(q,{class:"filter-card"},{default:o(()=>[l(J,{model:n.value,inline:""},{default:o(()=>[l(b,{label:"卡号"},{default:o(()=>[l(fe,{modelValue:n.value.search,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.search=a),placeholder:"输入卡号搜索",clearable:"",onKeyup:ke(y,["enter"]),style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(b,{label:"额度类型"},{default:o(()=>[l(V,{modelValue:n.value.poolType,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.poolType=a),style:{width:"120px"}},{default:o(()=>[(f(),_(k,null,S(de,a=>l(w,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"状态"},{default:o(()=>[l(V,{modelValue:n.value.status,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.status=a),style:{width:"120px"}},{default:o(()=>[(f(),_(k,null,S(ie,a=>l(w,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"剩余时间"},{default:o(()=>[l(V,{modelValue:n.value.remainingTimeType,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.remainingTimeType=a),style:{width:"160px"}},{default:o(()=>[(f(),_(k,null,S(H,a=>l(w,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"卡类型"},{default:o(()=>[l(V,{modelValue:n.value.cardType,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.cardType=a),style:{width:"100px"}},{default:o(()=>[(f(),_(k,null,S(Q,a=>l(w,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"卡头"},{default:o(()=>[l(V,{modelValue:n.value.cardPrefix,"onUpdate:modelValue":e[7]||(e[7]=a=>n.value.cardPrefix=a),style:{width:"100px"},filterable:"",clearable:"",placeholder:"选择"},{default:o(()=>[(f(!0),_(k,null,S(j.value,a=>(f(),M(w,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"卡台"},{default:o(()=>[l(V,{modelValue:n.value.accountName,"onUpdate:modelValue":e[8]||(e[8]=a=>n.value.accountName=a),style:{width:"150px"},filterable:"",clearable:"",placeholder:"选择"},{default:o(()=>[(f(!0),_(k,null,S(D.value,a=>(f(),M(w,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(b,null,{default:o(()=>[l(u,{type:"primary",onClick:y},{default:o(()=>[...e[24]||(e[24]=[i("搜索",-1)])]),_:1}),l(u,{onClick:re},{default:o(()=>[...e[25]||(e[25]=[i("重置",-1)])]),_:1}),l(u,{type:"success",loading:F.value,onClick:Z},{default:o(()=>[l(p,{class:"el-icon--left"},{default:o(()=>[l(ge)]),_:1}),e[26]||(e[26]=i(" 刷新选项 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),T.value.length>0?(f(),_("div",Le,[c("span",null,"已选择 "+v(T.value.length)+" 张卡片",1),l(u,{type:"primary",size:"small",onClick:le},{default:o(()=>[l(p,null,{default:o(()=>[l(ye)]),_:1}),e[27]||(e[27]=i(" 批量复制 ",-1))]),_:1}),l(u,{type:"danger",size:"small",onClick:te},{default:o(()=>[l(p,null,{default:o(()=>[l(be)]),_:1}),e[28]||(e[28]=i(" 批量删除 ",-1))]),_:1})])):Ce("",!0),l(q,{class:"table-card"},{default:o(()=>[Se((f(),M(_e,{data:I.value,stripe:"",style:{width:"100%"},onSelectionChange:ne},{default:o(()=>[l(h,{type:"selection",width:"55"}),l(h,{label:"卡号","min-width":"200"},{default:o(({row:a})=>[c("span",Me,v(me(a.pan)),1)]),_:1}),l(h,{label:"有效期",width:"100"},{default:o(({row:a})=>[i(v(a.expMonth)+"/"+v(a.expYear?.slice(-2)),1)]),_:1}),l(h,{label:"CVV",width:"80"},{default:o(({row:a})=>[i(v(a.cvv),1)]),_:1}),l(h,{label:"额度",width:"80"},{default:o(({row:a})=>[l(O,{size:"small"},{default:o(()=>[i(v(Y(a.poolType)),1)]),_:2},1024)]),_:1}),l(h,{label:"状态",width:"100"},{default:o(({row:a})=>[l(O,{size:"small",type:ce(a.status)},{default:o(()=>[i(v(pe(a.status)),1)]),_:2},1032,["type"])]),_:1}),l(h,{label:"剩余时间",width:"120"},{default:o(({row:a})=>[c("span",{class:$e(ve(a.remainingTime))},v(a.remainingTime||"-"),3)]),_:1}),l(h,{label:"类型",width:"80"},{default:o(({row:a})=>[l(O,{size:"small",type:a.cardType==="credit"?"success":"warning"},{default:o(()=>[i(v(a.cardType==="credit"?"信用卡":a.cardType==="debit"?"借记卡":"-"),1)]),_:2},1032,["type"])]),_:1}),l(h,{label:"所属卡台","min-width":"120"},{default:o(({row:a})=>[i(v(a.accountName||"-"),1)]),_:1}),l(h,{label:"关联卡密",width:"150"},{default:o(({row:a})=>[a.cardKey?(f(),_("span",Re,v(a.cardKey.keyCode),1)):(f(),_("span",Ae,"-"))]),_:1}),l(h,{label:"卡台创建时间",width:"180"},{default:o(({row:a})=>[i(v(a.cardCreatedAt?new Date(a.cardCreatedAt).toLocaleString():"-"),1)]),_:1})]),_:1},8,["data"])),[[Te,U.value]]),c("div",Ye,[l(he,{"current-page":r.value.page,"onUpdate:currentPage":e[9]||(e[9]=a=>r.value.page=a),"page-size":r.value.pageSize,"onUpdate:pageSize":e[10]||(e[10]=a=>r.value.pageSize=a),total:r.value.total,"page-sizes":[20,50,100,200,500],onCurrentChange:se,onSizeChange:ue,layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])]),_:1}),l(G,{modelValue:N.value,"onUpdate:modelValue":e[14]||(e[14]=a=>N.value=a),title:"爬取配置",width:"400px"},{footer:o(()=>[l(u,{onClick:e[13]||(e[13]=a=>N.value=!1)},{default:o(()=>[...e[29]||(e[29]=[i("取消",-1)])]),_:1}),l(u,{type:"primary",onClick:ae},{default:o(()=>[...e[30]||(e[30]=[i("保存",-1)])]),_:1})]),default:o(()=>[l(J,{model:x.value,"label-width":"120px"},{default:o(()=>[l(b,{label:"爬取间隔(分钟)"},{default:o(()=>[l(L,{modelValue:x.value.crawlInterval,"onUpdate:modelValue":e[11]||(e[11]=a=>x.value.crawlInterval=a),min:5,max:1440},null,8,["modelValue"])]),_:1}),l(b,{label:"过期检查(分钟)"},{default:o(()=>[l(L,{modelValue:x.value.expireCheckInterval,"onUpdate:modelValue":e[12]||(e[12]=a=>x.value.expireCheckInterval=a),min:5,max:60},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(G,{modelValue:z.value,"onUpdate:modelValue":e[18]||(e[18]=a=>z.value=a),title:"生成卡密",width:"400px"},{footer:o(()=>[l(u,{onClick:e[17]||(e[17]=a=>z.value=!1)},{default:o(()=>[...e[31]||(e[31]=[i("取消",-1)])]),_:1}),l(u,{type:"primary",loading:B.value,onClick:oe},{default:o(()=>[...e[32]||(e[32]=[i("生成",-1)])]),_:1},8,["loading"])]),default:o(()=>[l(J,{model:C.value,"label-width":"100px"},{default:o(()=>[l(b,{label:"额度类型"},{default:o(()=>[l(V,{modelValue:C.value.poolType,"onUpdate:modelValue":e[15]||(e[15]=a=>C.value.poolType=a),style:{width:"100%"}},{default:o(()=>[l(w,{value:"0dollar",label:"$0 (免费)"}),l(w,{value:"1dollar",label:"$1"}),l(w,{value:"2dollar",label:"$2"})]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"生成数量"},{default:o(()=>[l(L,{modelValue:C.value.count,"onUpdate:modelValue":e[16]||(e[16]=a=>C.value.count=a),min:1,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),He=Ne(qe,[["__scopeId","data-v-35aaca7c"]]);export{He as default};
